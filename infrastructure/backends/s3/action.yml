name: terraform init
description: This action initializes terraform with the AWS S3 backend.

inputs:
  aws-role-arn:
    description: AWS IAM role ARN for Terraform, both for the AWS provider and for the S3 state backend.
    required: true
  stack-path:
    description: Path to stack directory
    required: true

runs:
  using: composite
  steps:
    - uses: actions/checkout@v5

    - name: Authenticate with AWS
      uses: aws-actions/configure-aws-credentials@v5
      with:
        aws-region: ca-central-1
        role-to-assume: ${{ inputs.aws-role-arn }}

    - name: Install Terraform
      uses: hashicorp/setup-terraform@v3

    - name: terraform init
      shell: bash
      run: |
        cd '${{ inputs.stack-path }}'
        terraform init -input=false
